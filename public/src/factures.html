<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="/bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="/bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="/bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="/bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/slide-from-left-animation.html">

<link rel="import" href="/bower_components/app-route/app-location.html">
<link rel="import" href="/bower_components/app-route/app-route.html">

<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="/bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">

<link rel="import" href="./shared-styles.html">

<dom-module id="user-factures">
  <template>
    <style is="custom-style" include="shared-styles iron-flex iron-positioning iron-flex-alignment">
      :host {
        display: block;
      }
    </style>

    <app-route
      route="{{route}}"
      pattern="/list"
      active="{{listActive}}">
    </app-route>
    <app-route
      route="{{route}}"
      pattern="/show/:id"
      data="{{showData}}"
      active="{{showActive}}">
    </app-route>

    <app-header-layout class="full-height" has-scrolling-region>
      <app-header condenses reveals effects="waterfall">
        <app-toolbar>
          <a id="backButton" href="/homepage"><paper-icon-button icon="arrow-back"></paper-icon-button></a>
          <div title>Mes factures</div>
        </app-toolbar>
      </app-header>

      <neon-animated-pages
        class="full-height"
        entry-animation="slide-from-left-animation"
        exit-animation="fade-out-animation"
        selected="{{selected}}">

        <factures-list class="full-height" factures="{{factures}}">
        </factures-list>
        <facture-detail facture="{{selectedFacture}}">
        </facture-detail>

      </neon-animated-pages>
    </app-header-layout>
  </template>

  <script>
    Polymer({

      is: 'user-factures',

      properties: {
        factures: {
          type: Array,
          value: function(){
            return [{name: "Facture 1", total: 456, client: "Client Name", ref: 1}, {name: "Facture 2", total: 232, client: "Client Name", ref: 2}, {name: "Facture 3", total: 1056, client: "Client Name", ref: 3}, {name: "Facture 4", total: 369, client: "Client Name", ref: 4}, {name: "Facture 5", total: 30, client: "Client Name", ref: 5}, {name: "Facture X", total: "XXX", client: "Client Name", ref: 6}, {name: "Facture X", total: "XXX", client: "Client Name", ref: 7}, {name: "Facture X", total: "XXX", client: "Client Name", ref: 8}]
          }
        },
        route:{
          type: Object,
          observer: '_routeChanged'
        },
        showData: {
          type: Object,
        },
        showActive: {
          type: Boolean,
        },
        listActive: {
          type: Boolean,
        },
        selected: {
          type: Number,
          value: 0
        },
        selectedFacture: {
          type: Object
        }
      },

      _routeChanged: function (route) {
        if (route && route.prefix == '/factures'){
          if (this.listActive){
            this.selected = 0;
            console.log(this.$.backButton);
            this.$.backButton.href = "/homepage"
          }
          else if (this.showActive){
            this.$.backButton.href = "/factures/list"
            this.selectedFacture = this.factures[this.showData.id - 1];
            this.selected = 1;
          }
        }
      },
    });
  </script>
</dom-module>

<dom-module id="factures-list">
  <template>
    <style is="custom-style" include="shared-styles iron-flex iron-positioning iron-flex-alignment">
      :host {
        display: block;
      }
    </style>

    <div class="full-height vertical layout list">
      <template is="dom-repeat" items=[[factures]]>
        <facture-item class="item" facture="{{item}}"></facture-item>
      </template>
    </div>

  </template>
  <script>
    Polymer({
      is: 'factures-list',

      properties: {
        factures: {
          type: Array
        }
      }
    });
  </script>
</dom-module>

<dom-module id="facture-detail">
  <template>
    <style is="custom-style" include="shared-styles iron-flex iron-positioning iron-flex-alignment">
      :host {
        display: block;
        /*padding: 10px;*/
      }

      .facture-layout {
        font-weight: 300;
        padding: 10px;
      }

      .entete {
        margin-bottom: 15px;
      }

      .entete .entreprise-info {
        margin-right: 15px;
      }

      .facture-info p {
        margin: 5px 0px;
      }

      .facture-info {
        margin-bottom: 15px;
      }

      table {
        width: 100%;
      }

      table td {
        padding: 0;
      }

      .articles-list table {
        text-align: center;
        border-collapse: collapse;
      }

      .articles-list  table th {
        padding: 10px;
        height: 54px;
        font-weight: 300;
      }

      .articles-list  table td {
        padding: 10px;
        height: 48px;
        font-weight: 100;
      }

      .articles-list table tr td:first-child, .articles-list table tr th:first-child {
        text-align: left;
      }

      .articles-list table tr td:last-child, .articles-list table tr th:last-child {
        text-align: right;
      }

      .articles-list table tbody tr:hover {
        background-color: #EEEEEE;
      }

      .articles-list table thead tr th {
        border-bottom: 1px solid #d4d4d4;
      }

      .articles-list table tbody tr:not(:last-child) td {
        border-bottom: 1px solid var(--app-divider-color);
      }

      @media screen and (max-width: 768px) {
        .horizontal.layout.entete {
          display: inline-block;
        }
        .entreprise-info {
          margin-right: 0px;
          margin-bottom: 15px;
          width: 100%;
          float: left;
        }

        .client-info {
          width: 100%;
          float: left;
        }
      }
    </style>

    <div class="vertical layout facture-layout">

      <!-- Début en-tête -->
      <div class="horizontal layout entete">

        <!-- Informations Entreprise -->
        <paper-card class="entreprise-info">
          <div class="card-content">
            <table>
              <tbody>
                <tr>
                  <td>
                    LACAZEDIEU PLOMBERIE
                  </td>
                </tr>
                <tr>
                  <td>
                    12 avenue Charles de Gaulle, 81300 Graulhet
                  </td>
                </tr>
                <tr>
                  <td>
                    05 63 34 55 03
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </paper-card>

        <div class="flex"></div>

        <!-- Informations Client -->
        <paper-card class="client-info">
          <div class="card-content">
            <table>
              <tbody>
                <tr>
                  <td>
                    Paul LACAZEDIEU
                  </td>
                </tr>
                <tr>
                  <td>
                    54 bis avenue Bérénice, 81300 Graulhet
                  </td>
                </tr>
                <tr>
                  <td>
                    06 35 12 08 25
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </paper-card>

      </div>
      <!-- Fin en-tête -->

      <!-- Début informations facture -->
      <paper-card class="facture-info">
        <div class="card-content horizontal layout">
          <div>
            <p>{{facture.name}}</p>
          </div>
          <div class="flex"></div>
          <div class="vertical layout">
            <p>Date</p>
            <p>Heure</p>
          </div>
        </div>
      </paper-card>
      <!-- Fin informations facture -->

      <!-- Début liste articles -->
      <paper-card class="articles-list">
        <div class="vertical layout">
          <table>
            <thead>
              <tr>
                <th>
                  Article
                </th>
                <th>
                  Quantité
                </th>
                <th>
                  Prix
                </th>
                <th>
                  Total
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  Article 1
                </td>
                <td>
                  5
                </td>
                <td>
                  25.99 €
                </td>
                <td>
                  129.95 €
                </td>
              </tr>
              <tr>
                <td>
                  Article 1
                </td>
                <td>
                  5
                </td>
                <td>
                  25.99 €
                </td>
                <td>
                  129.95 €
                </td>
              </tr>
              <tr>
                <td>
                  Article 1
                </td>
                <td>
                  5
                </td>
                <td>
                  25.99 €
                </td>
                <td>
                  129.95 €
                </td>
              </tr>
              <tr>
                <td>
                  Article 1
                </td>
                <td>
                  5
                </td>
                <td>
                  25.99 €
                </td>
                <td>
                  129.95 €
                </td>
              </tr>
              <tr>
                <td>
                  Article 1
                </td>
                <td>
                  5
                </td>
                <td>
                  25.99 €
                </td>
                <td>
                  129.95 €
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="card-actions horizontal layout end-justified">
          <p>Total: XXX €</p>
        </div>
      </paper-card>
      <!-- Fin liste articles -->

    </div>

  </template>
  <script>
    Polymer({
      is: 'facture-detail',

      properties: {
        facture: {
          type: Object
        }
      }
    });
  </script>
</dom-module>

<dom-module id="facture-item">
    <template>
      <style is="custom-style" include="shared-styles iron-flex iron-positioning iron-flex-alignment">
        :host {
          display: block;
        }

        .vertical.layout{
          padding: 10px;
        }

        p{
          margin: 0;
          padding: 5px 0 0 0;
        }

        a{
          color: black;
          text-decoration: none;
        }
      </style>

      <a href="/factures/show/{{facture.ref}}">
        <div class="vertical layout">
          <div class="horizontal layout">
            <p class="flex">{{facture.name}}</p>
            <p>{{facture.total}} €</p>
          </div>
          <p>{{facture.client}}</p>
          <paper-ripple fit></paper-ripple>
        </div>
      </a>

    </template>
    <script>
      Polymer({

        is: 'facture-item',

        properties: {
          facture: {
            type: Object
          }
        }

      });

    </script>
</dom-module>
