<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../shared-styles.html">

<dom-module id="facture-detail">
  <template>
    <style is="custom-style" include="shared-styles iron-flex iron-positioning iron-flex-alignment">
      :host {
        display: block;
      }

      .facture-layout {
        font-weight: 300;
        padding: 10px;
      }

      .facture-layout paper-card {
        width: 100%;
      }

      .entete {
        margin-bottom: 15px;
      }

      .entete .entreprise-info {
        margin-right: 15px;
      }

      .facture-info p {
        margin: 5px 0px;
      }

      .facture-info {
        margin-bottom: 15px;
      }

      .list .item {
        padding: 10px 5px
      }

      @media screen and (max-width: 768px) {
        .horizontal.layout.entete {
          display: inline-block;
        }
        .entreprise-info {
          margin-right: 0px;
          margin-bottom: 15px;
          width: 100%;
          float: left;
        }

        .client-info {
          width: 100%;
          float: left;
        }
      }
    </style>

    <div class="facture-layout">

      <paper-card id="facture">

        <div class="card-content vertical layout">
          <!-- Début en-tête -->
          <div class="horizontal layout entete">

            <!-- Informations Entreprise -->
            <div class="entreprise-info">
              <table>
                <tbody>
                  <tr>
                    <td>
                      <h2>{{user.name}}</h2>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{user.address}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{user.email}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{user.phone_number}}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="flex"></div>

            <!-- Informations Client -->
            <div class="client-info">
              <table>
                <tbody>
                  <tr>
                    <td>
                      <h2>{{client.name}}</h2>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{client.address}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{client.email}}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {{client.phone_number}}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Fin en-tête -->
          </div>

          <!-- Début informations facture -->
          <div class="horizontal layout facture-info">
            <div>
              <p>{{facture.name}}</p>
            </div>
            <div class="flex"></div>
            <div class="vertical layout">
              <p>{{facture.date}}</p>
              <p>{{facture.hour}}</p>
            </div>
          </div>
          <!-- Fin informations facture -->

          <!-- Début liste articles -->
          <div class="vertical layout articles-list">
            <table>
              <thead>
                <tr>
                  <th>
                    Désignation
                  </th>
                  <th>
                    Quantité
                  </th>
                  <th>
                    Prix
                  </th>
                  <th>
                    Total
                  </th>
                </tr>
              </thead>
              <tbody>
                <template is="dom-repeat" items="{{facture.articles}}">
                  <tr>
                    <td>
                      {{item.des}}
                    </td>
                    <td>
                      {{item.qty}}
                    </td>
                    <td>
                      {{item.price}}
                    </td>
                    <td>
                      {{item.total}}
                    </td>
                  </tr>
                </template>
              </tbody>
              <tfoot>
                <td></td>
                <td></td>
                <td></td>
                <td>
                  Total: {{facture.total}} €
                </td>
              </tfoot>
            </table>
          </div>
          <!-- Fin liste articles -->

        </div>

        <div class="card-actions horizontal layout justified">
          <a href="/factures/edit/{{key}}"><paper-button>Modifier</paper-button></a>
          <paper-button on-tap="print">Imprimer</paper-button>
        </div>

      </paper-card>

    </div>

  </template>
  <script>
    Polymer({
      is: 'facture-detail',

      properties: {
        user: {
          type: Object
        },
        client: {
          type: Object
        },
        facture: {
          type: Object
        }
      },

      observers: [
        '_clientChanged(facture.client_key)'
      ],

      _clientChanged: function (key){
        if (key){
          this.client = this.clients[key];
        }
      },

      print: function () {
        var myWindow = window.open('', 'Facture', 'height=600,width=1200');

        myWindow.document.write('<html><head><title>Impression facture</title>');
        myWindow.document.write('<link rel="import" href="./print.html">');
        myWindow.document.write('<style>body { margin: 0;}</style>');
        myWindow.document.write('</head><body>');
        myWindow.document.write('<facture-print id="print" user=\''+ JSON.stringify(this.user) +'\' facture=\''+ JSON.stringify(this.facture) +'\' client=\''+ JSON.stringify(this.client) +'\'></facture-print>');
        myWindow.document.write('</body></html>');


        myWindow.document.close();
        myWindow.focus();

        return true;
      },

    });
  </script>
</dom-module>
